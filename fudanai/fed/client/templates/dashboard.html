<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Federated Task Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="p-4">
    <div class="container">
      <h1 class="mb-4">ğŸ“‹ Federated Task Dashboard</h1>

      <!-- Tabs -->
      <ul class="nav nav-tabs mb-3" id="tabMenu">
        <li class="nav-item">
          <a class="nav-link active" onclick="switchTab('taskTab')" href="#">ä»»åŠ¡åˆ—è¡¨</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="switchTab('createTab')" href="#">åˆ›å»ºä»»åŠ¡</a>
        </li>
      </ul>

      <!-- Task List Tab -->
      <div id="taskTab">
        <div id="taskListContainer" class="row gy-3"></div>
      </div>

      <!-- Placeholder for Create Task Tab (Empty for Now) -->
      <div id="createTab" style="display: none">
        <p class="text-muted">ğŸ›  æš‚æœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>
      </div>
    </div>

    <script>
      function switchTab(tabId) {
        document.getElementById("taskTab").style.display = "none";
        document.getElementById("createTab").style.display = "none";

        document.getElementById(tabId).style.display = "block";

        // åˆ‡æ¢æ¿€æ´» tab æ ·å¼
        document.querySelectorAll(".nav-link").forEach(link =>
          link.classList.remove("active")
        );
        event.target.classList.add("active");
      }

      async function deleteTask(id) {
        if (!confirm("ç¡®è®¤åˆ é™¤è¯¥ä»»åŠ¡ï¼Ÿ")) return;

        const res = await fetch(`/delete_task?id=${id}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          alert("âœ… ä»»åŠ¡å·²åˆ é™¤");
          loadTasks(); // é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨
        } else {
          const error = await res.json();
          alert("âŒ åˆ é™¤å¤±è´¥: " + (error.error || "æœªçŸ¥é”™è¯¯"));
        }
      }

      async function loadTasks() {
        const res = await fetch("/list_tasks");
        const data = await res.json();
        const container = document.getElementById("taskListContainer");
        container.innerHTML = "";

        data.forEach(task => {
          const card = document.createElement("div");
          card.className = "col-md-6";

          card.innerHTML = `
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">ä»»åŠ¡å: ${task.name}</h5>
                <p><strong>ä»»åŠ¡ ID:</strong> ${task.id}</p>
                <p><strong>çŠ¶æ€:</strong> ${task.status}</p>
                <p><strong>æœåŠ¡å™¨åœ°å€:</strong> ${task.server}</p>
                <p><strong>å®Œæˆè½®æ¬¡:</strong> ${task.completed_epoch} / ${task.epochs}</p>
                <button class="btn btn-danger btn-sm" onclick="deleteTask('${task.id}')">ğŸ—‘ åˆ é™¤ä»»åŠ¡</button>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      loadTasks();
      setInterval(loadTasks, 5000);
    </script>
  </body>
</html>
